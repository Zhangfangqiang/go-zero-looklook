## 1.创建sql

## 2.创建目录 编写 api 文件 
```shell
mkdir "go-zero-looklook/app/cms/cmd/api/desc/clearing"
vim "go-zero-looklook/app/cms/cmd/api/desc/clearing/clearing.api"
```
```go
syntax = "v1"

info(
	title: "出清数据实例"
	desc: "出清数据实例"
	author: "CMS"
	email: "cms@example.com"
)

type ClearingData {
	Id                      int64   `json:"id"`
	ProvinceId              int64   `json:"provinceId"`
	CompanyId               string  `json:"companyId"`
	CompanyName             string  `json:"companyName"`
	UnitId                  string  `json:"unitId"`
	UnitName                string  `json:"unitName"`
	TargetDate              string  `json:"targetDate"`
	Timeperiod              string  `json:"timeperiod"`
	DayaheadClearingEnergy  float64 `json:"dayaheadClearingEnergy"`
	DayaheadClearingPrice   float64 `json:"dayaheadClearingPrice"`
	RealtimeClearingEnergy  float64 `json:"realtimeClearingEnergy"`
	RealtimeClearingPrice   float64 `json:"realtimeClearingPrice"`
	DayaheadBidPower        float64 `json:"dayaheadBidPower"`
	RealtimeBidPower        float64 `json:"realtimeBidPower"`
	ActualEnergy            float64 `json:"actualEnergy"`
	ActualPower             float64 `json:"actualPower"`
	CreateTime              string  `json:"createTime"`
	UpdateTime              string  `json:"updateTime"`
}

type (
	CreateClearingDataReq {
		ProvinceId             int64   `json:"provinceId"`
		CompanyId              string  `json:"companyId"`
		CompanyName            string  `json:"companyName"`
		UnitId                 string  `json:"unitId"`
		UnitName               string  `json:"unitName"`
		TargetDate             string  `json:"targetDate"` // format: YYYY-MM-DD
		Timeperiod             string  `json:"timeperiod"`
		DayaheadClearingEnergy float64 `json:"dayaheadClearingEnergy,optional"`
		DayaheadClearingPrice  float64 `json:"dayaheadClearingPrice,optional"`
		RealtimeClearingEnergy float64 `json:"realtimeClearingEnergy,optional"`
		RealtimeClearingPrice  float64 `json:"realtimeClearingPrice,optional"`
		DayaheadBidPower       float64 `json:"dayaheadBidPower,optional"`
		RealtimeBidPower       float64 `json:"realtimeBidPower,optional"`
		ActualEnergy           float64 `json:"actualEnergy,optional"`
		ActualPower            float64 `json:"actualPower,optional"`
	}
	CreateClearingDataResp {
		Id int64 `json:"id"`
	}
)

type (
	UpdateClearingDataReq {
		Id                     int64   `json:"id"`
		DayaheadClearingEnergy float64 `json:"dayaheadClearingEnergy,optional"`
		DayaheadClearingPrice  float64 `json:"dayaheadClearingPrice,optional"`
		RealtimeClearingEnergy float64 `json:"realtimeClearingEnergy,optional"`
		RealtimeClearingPrice  float64 `json:"realtimeClearingPrice,optional"`
		DayaheadBidPower       float64 `json:"dayaheadBidPower,optional"`
		RealtimeBidPower       float64 `json:"realtimeBidPower,optional"`
		ActualEnergy           float64 `json:"actualEnergy,optional"`
		ActualPower            float64 `json:"actualPower,optional"`
	}
	UpdateClearingDataResp {
		Success bool `json:"success"`
	}
)

type (
	ClearingDataDetailReq {
		Id int64 `json:"id"`
	}
	ClearingDataDetailResp {
		ClearingData ClearingData `json:"clearingData"`
	}
)

type (
	ClearingDataListReq {
		CompanyId  string `json:"companyId,optional"`
		TargetDate string `json:"targetDate,optional"` // format: YYYY-MM-DD
		Page       int64  `json:"page,default=1"`
		PageSize   int64  `json:"pageSize,default=10"`
	}
	ClearingDataListResp {
		List  []ClearingData `json:"list"`
		Total int64          `json:"total"`
	}
)

type (
	DeleteClearingDataReq {
		Id int64 `json:"id"`
	}
	DeleteClearingDataResp {
		Success bool `json:"success"`
	}
)

type (
	BatchCreateClearingDataReq {
		DataList []CreateClearingDataReq `json:"dataList"`
	}
	BatchCreateClearingDataResp {
		SuccessCount int64 `json:"successCount"`
		FailedCount  int64 `json:"failedCount"`
	}
)

```

## 3.注入 `go-zero-looklook/app/cms/cmd/api/desc/clearing` 编辑 `go-zero-looklook/app/cms/cmd/api/desc/cms.api`
```
import (
    .
    .
    .
	"clearing/clearing.api"
)

// ========== 不需要登录的接口 ==========
@server (
	prefix: cms/v1
	group:  clearing
)
service cms {
	@doc "获取出清数据列表"
	@handler clearingDataList
	post /clearing/list (ClearingDataListReq) returns (ClearingDataListResp)

	@doc "获取出清数据详情"
	@handler clearingDataDetail
	post /clearing/detail (ClearingDataDetailReq) returns (ClearingDataDetailResp)
}


// ========== 需要登录的接口 ==========
@server (
	prefix: cms/v1
	group:  clearing
	jwt:    JwtAuth
)
service cms {
	@doc "创建出清数据"
	@handler createClearingData
	post /clearing/create (CreateClearingDataReq) returns (CreateClearingDataResp)

	@doc "批量创建出清数据"
	@handler batchCreateClearingData
	post /clearing/batch-create (BatchCreateClearingDataReq) returns (BatchCreateClearingDataResp)

	@doc "更新出清数据"
	@handler updateClearingData
	post /clearing/update (UpdateClearingDataReq) returns (UpdateClearingDataResp)

	@doc "删除出清数据"
	@handler deleteClearingData
	post /clearing/delete (DeleteClearingDataReq) returns (DeleteClearingDataResp)
}
```

## 4.执行命令生成相关 api 文件
```shell
cd /Users/a111/Documents/code/go/go-zero-looklook/app/cms/cmd/api/desc && goctl api go -api *.api -dir ../ -style=goZero
```



## 5.rpc  proto 协议添加
```
message ClearingData {
  int64 id = 1;
  int64 provinceId = 2;
  string companyId = 3;
  string companyName = 4;
  string unitId = 5;
  string unitName = 6;
  string targetDate = 7;
  string timeperiod = 8;
  double dayaheadClearingEnergy = 9;
  double dayaheadClearingPrice = 10;
  double realtimeClearingEnergy = 11;
  double realtimeClearingPrice = 12;
  double dayaheadBidPower = 13;
  double realtimeBidPower = 14;
  double actualEnergy = 15;
  double actualPower = 16;
  string createTime = 17;
  string updateTime = 18;
}

message CreateClearingDataReq {
  int64 provinceId = 1;
  string companyId = 2;
  string companyName = 3;
  string unitId = 4;
  string unitName = 5;
  string targetDate = 6;
  string timeperiod = 7;
  double dayaheadClearingEnergy = 8;
  double dayaheadClearingPrice = 9;
  double realtimeClearingEnergy = 10;
  double realtimeClearingPrice = 11;
  double dayaheadBidPower = 12;
  double realtimeBidPower = 13;
  double actualEnergy = 14;
  double actualPower = 15;
}
message CreateClearingDataResp {
  int64 id = 1;
}

message UpdateClearingDataReq {
  int64 id = 1;
  double dayaheadClearingEnergy = 2;
  double dayaheadClearingPrice = 3;
  double realtimeClearingEnergy = 4;
  double realtimeClearingPrice = 5;
  double dayaheadBidPower = 6;
  double realtimeBidPower = 7;
  double actualEnergy = 8;
  double actualPower = 9;
}
message UpdateClearingDataResp {
  bool success = 1;
}

message GetClearingDataDetailReq {
  int64 id = 1;
}
message GetClearingDataDetailResp {
  ClearingData clearingData = 1;
}

message GetClearingDataListReq {
  string companyId = 1;
  string targetDate = 2;
  int64 page = 3;
  int64 pageSize = 4;
}
message GetClearingDataListResp {
  repeated ClearingData list = 1;
  int64 total = 2;
}

message DeleteClearingDataReq {
  int64 id = 1;
}
message DeleteClearingDataResp {
  bool success = 1;
}

message BatchCreateClearingDataReq {
  repeated CreateClearingDataReq dataList = 1;
}
message BatchCreateClearingDataResp {
  int64 successCount = 1;
  int64 failedCount = 2;
}

service cms {
.
.
.
  rpc createClearingData(CreateClearingDataReq) returns(CreateClearingDataResp);
  rpc updateClearingData(UpdateClearingDataReq) returns(UpdateClearingDataResp);
  rpc getClearingDataDetail(GetClearingDataDetailReq) returns(GetClearingDataDetailResp);
  rpc getClearingDataList(GetClearingDataListReq) returns(GetClearingDataListResp);
  rpc deleteClearingData(DeleteClearingDataReq) returns(DeleteClearingDataResp);
  rpc batchCreateClearingData(BatchCreateClearingDataReq) returns(BatchCreateClearingDataResp);
}
```


## 命令生成 rpc 协议代码
```
cd /Users/a111/Documents/code/go/go-zero-looklook/app/cms/cmd/rpc && goctl rpc protoc pb/cms.proto --go_out=./ --go-grpc_out=./ --zrpc_out=./ --style=goZero
```

## 命令 更具sql 生成 model 
```
cd /Users/a111/Documents/code/go/go-zero-looklook/app/cms/model && goctl model mysql ddl -src ../../../deploy/sql/looklook_cms.sql -dir . -c -style=goZero
```